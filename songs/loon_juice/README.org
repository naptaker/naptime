#+OPTIONS: title:t toc:t date:nil author:t email:nil num:nil ^:{}
#+LATEX_CLASS: article
#+LATEX_HEADER: \usemintedstyle{lovelace}
#+TITLE: Loon Juice
#+DATE: [2016-06-11 Sat]
#+AUTHOR: Eric Bailey
#+EMAIL: naptakerband@gmail.com
#+DESCRIPTION:
#+KEYWORDS:
#+SUBTITLE:
#+DATE: \today
#+LANGUAGE: en
#+CREATOR: Emacs 25.1.1 (Org mode 8.3.4)

#+NAME: setup-minted
#+BEGIN_SRC emacs-lisp :exports results :results silent
(setq org-latex-listings 'minted)
(setq org-latex-minted-options nil)
(add-to-list 'org-latex-packages-alist '("" "minted" t))
(add-to-list 'org-latex-packages-alist '("nopostdot" "glossaries" nil))
(delete '("" "fixltx2e" nil) org-latex-default-packages-alist)
(let ((cmd (concat "pdflatex -shell-escape "
                   "-interaction nonstopmode "
                   "-synctex=1 "
                   "-output-directory %o %f")))
  (setq org-latex-pdf-process (list cmd cmd cmd)))
(setq org-latex-hyperref-template
 "\\hypersetup{
   pdfauthor   = {%a},
   pdftitle    = {%t},
   pdfkeywords = {%k},
   pdfsubject  = {%d},
   pdfcreator  = {%c},
   pdflang     = {%L},
   colorlinks  = true,
   linkcolor   = magenta,
   %% anchorcolor = magenta,
   citecolor   = green,
   urlcolor    = cyan
 }
")
#+END_SRC

#+LATEX: \clearpage


[[file:main.png]]

* Front Matter
:PROPERTIES:
:tangle:   include/global.ily
:END:
Every good LilyPond file starts with a ~\version~:
#+BEGIN_SRC LilyPond
\version "2.19.24"
#+END_SRC

Include some libraries and such:
#+BEGIN_SRC LilyPond
#(load "../../include/naptaker.scm")
\include "preamble.ily"
\include "instruments.ily"
\include "openlilylib"
\useLibrary gridly
#+END_SRC

Define some useful variables.
#+BEGIN_SRC LilyPond
Key    = { \key c \major }
Tempo  = { \tempo 4 = 168 }
global = { \Tempo \defaultTimeSignature \time 4/4 }
#+END_SRC

Then the ~\header~ metadata:
#+BEGIN_SRC LilyPond
\header {
  title    = "Loon Juice"
  opus     = "Naptime"
  composer = "Naptaker"
  %% poet     = "Preston Y. Drum"
  %% arranger = "Naptaker"
  copyright = "Â© 2016 Naptaker"
}
#+END_SRC

Initialize the grid and template with a list of parts
and a list of the lengths (in measures) of each segment.
#+BEGIN_SRC LilyPond
\templateInit #'("meta"
                 "vox"
                 "guitar" "guitar strum"
                 "bass"
                 "drums up" "drums down")
              #'(8 8 16 16 16 16 8 8)
#+END_SRC
* Segments
** I: Guitar Intro
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 1
{
  \global
  \mark 1
  s1*8
  \break
}
#+END_SRC
*** TODO Vocals
*** Guitar
#+BEGIN_SRC LilyPond :tangle parts/guitar-I.ily
\include "global.ily"

\gridPutMusic "guitar" 1
\relative c' {
  \include "notes/guitar-I.ily"
}

\gridCompileCell "guitar" 1
#+END_SRC
**** Notes
:PROPERTIES:
:noweb:    yes
:END:
#+BEGIN_SRC LilyPond :tangle notes/guitar-I.ily
\set minimumFret = #3
<<notes-guitar-Ia>>
<<notes-guitar-Ib>>
<<notes-guitar-Ia>>
\set minimumFret = #6
<<notes-guitar-Ic>>
\set minimumFret = #3
#+END_SRC
#+NAME: notes-guitar-Ia
#+BEGIN_SRC LilyPond
g4  8 f g       bes f    fis |
g4  8 f d'4\3       f\2      |
#+END_SRC
#+NAME: notes-guitar-Ib
#+BEGIN_SRC LilyPond
g,4 8 f g       bes f    fis |
g4  8 f des'4\3     ges,     |
#+END_SRC
#+NAME: notes-guitar-Ic
#+BEGIN_SRC LilyPond
bes,4   8 a   bes4      aes8 a |
bes8  d a des c    aes  g4\4   |
#+END_SRC
*** Bass
The bass doesn't come in until the fifth measure.
#+BEGIN_SRC LilyPond :tangle parts/bass-I.ily
\include "global.ily"

\gridPutMusic "bass" 1
\relative c, {
  \include "notes/bass-I.ily"
}

\gridCompileCell "bass" 1
#+END_SRC
**** Notes
#+BEGIN_SRC LilyPond :tangle notes/bass-I.ily
R1 |
r2 d4 f |
R1 |
r2 des4 ges, |
R1 |
r2 d'4 f |
bes,4 8 a bes4      aes8 a   |
bes8  d a des   c   aes  g4  |
#+END_SRC
*** TODO Drums
** II: Full Band Intro
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 2
{
  \mark 2
  s1*8
  \break
}
#+END_SRC
*** Guitar
#+BEGIN_SRC LilyPond :tangle parts/guitar-II.ily
\include "global.ily"

\gridPutMusic "guitar" 2
\relative c' {
  \include "notes/guitar-I.ily"
}

\gridCompileCell "guitar" 2
#+END_SRC
*** Bass
#+BEGIN_SRC LilyPond :tangle parts/bass-II.ily
\include "global.ily"

\gridPutMusic "bass" 2
\relative c, {
  \include "notes/bass-II.ily"
}

\gridCompileCell "bass" 2
#+END_SRC
**** Notes
#+BEGIN_SRC LilyPond :tangle notes/bass-II.ily
g4    8 f g     bes f    fis |
g4    8 f d'4       f        |
g,4   8 f g     bes f    fis |
g4    8 f des'4     ges,     |
g4    8 f g     bes f    fis |
g4    8 f d'4       f        |
bes,4 8 a bes4      aes8 a   |
bes8  d a des   c   aes  g4  |
#+END_SRC
*** TODO Drums
** III: Bass and Tremolo Chords
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 3
{
  \mark 3
  s1*16
  \break
}
#+END_SRC
*** DONE Guitar
CLOSED: [2016-07-10 Sun 20:29]
#+BEGIN_SRC LilyPond :tangle parts/guitar-III.ily
\include "global.ily"

\gridPutMusic "guitar" 3
\chordmode {
  \stopStaffNotTabStaff
  \include "notes/guitar-III.ily"
  \restartStaff
}

\gridCompileCell "guitar" 3
#+END_SRC
**** DONE Notes
CLOSED: [2016-07-10 Sun 20:29]
#+BEGIN_SRC LilyPond :tangle notes/guitar-III.ily
\set restrainOpenStrings = ##t
%% \powerChords

\set minimumFret = #3 g,,1:1.5.8.10 ~ |
2 bes,,4:3.5.8.10^1 \set minimumFret = #7 a,,:1.5.8.10 |

\set minimumFret = #8 bes,,1:1.5.8.10 ~ |
2 \set minimumFret = #11 \fuzzOn des,4:1.5.8.10 q \fuzzOff |

\set minimumFret = #3 g,,1:1.5.8.10 ~ |
2 bes,,4:3.5.8.10^1 \set minimumFret = #7 a,,:1.5.8.10 |

\set minimumFret = #6
bes,,2:1.5.8.10 \acciaccatura { q16 16 } q2 |
d8:6-3-^5 q q q cis4:6-3-^5 c4:6-3-^5 |

\set minimumFret = #3 g,,1:1.5.8.10 ~ |
2 bes,,4:3.5.8.10^1 \set minimumFret = #7 a,,:1.5.8.10 |

\set minimumFret = #8 bes,,1:1.5.8.10 ~ |
2 \set minimumFret = #4 \fuzzOn ges,,4:1.5.8.10 q \fuzzOff |

\set minimumFret = #3 g,,1:1.5.8.10 ~ |
2 bes,,4:3.5.8.10^1 \set minimumFret = #7 a,,:1.5.8.10 |

\set minimumFret = #6
bes,,2:1.5.8.10 \acciaccatura { q16 16 } q2 |
d8:6-3-^5 q q q cis4:6-3-^5 c4:6-3-^5 |
#+END_SRC
*** Guitar Strum
#+BEGIN_SRC LilyPond :tangle parts/guitar_strum-III.ily
\include "global.ily"

\gridPutMusic "guitar strum" 3
\relative c {
  \include "notes/guitar_strum-III.ily"
}

\gridCompileCell "guitar strum" 3
#+END_SRC
**** Notes
#+BEGIN_SRC LilyPond :tangle notes/guitar_strum-III.ily
g1 ~ | 2 d'4 a | bes1 ~ | 2 des4 4 |

g1 ~ | 2 d'4 a | bes2 \acciaccatura { 16 16 } 2 | d8 8 8 8 cis4-. c-. |

g,1 ~ | 2 d'4 a | bes1 ~ | 2 ges4 4 |

g1 ~ | 2 d'4 a | bes2 \acciaccatura { 16 16 } 2 | d8 8 8 8 cis4-. c-. |
#+END_SRC
*** Bass
#+BEGIN_SRC LilyPond :tangle parts/bass-III.ily
\include "global.ily"

\gridPutMusic "bass" 3
\relative c, {
  \repeat unfold 2 {
    \include "notes/bass-II.ily"
  }
}

\gridCompileCell "bass" 3
#+END_SRC
*** TODO Drums
** IV:
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 4
{
  \mark 4
  s1*16
  \break
}
#+END_SRC
*** Guitar
#+BEGIN_SRC LilyPond :tangle parts/guitar-IV.ily
\include "global.ily"

\gridPutMusic "guitar" 4
\relative c' {
  \include "notes/guitar-I.ily"
  \include "notes/guitar-IV.ily"
}

\gridCompileCell "guitar" 4
#+END_SRC
**** Notes
#+BEGIN_SRC LilyPond :tangle notes/guitar-IV.ily
\set minimumFret = #3
b4    8 ais b     d   a    ais |
b4    8 a   e'4       g        |
b,4   8 a   b     d   a    ais |
b4    8 a   e'4       bes      |
b4    8 ais b     d   a    ais |
b4    8 a   e'4       g        |
\set minimumFret = #6
f4    8 8   4         8    8   |
f8  8 8 8   e4        ees      |
\set minimumFret = #3
#+END_SRC
*** Bass
#+BEGIN_SRC LilyPond :tangle parts/bass-IV.ily
\include "global.ily"

\gridPutMusic "bass" 4
\relative c, {
  \repeat unfold 2 {
    \include "notes/bass-II.ily"
  }
}

\gridCompileCell "bass" 4
#+END_SRC
*** TODO Drums
** V: Bass and Tremolo Chords (again)
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 5
{
  \mark 5
  s1*16
  \break
}
#+END_SRC
*** DONE Guitar
CLOSED: [2016-08-19 Fri 22:38]
#+BEGIN_SRC LilyPond :tangle parts/guitar-V.ily
\include "global.ily"

\gridPutMusic "guitar" 5
\chordmode {
  \stopStaffNotTabStaff
  \include "notes/guitar-III.ily"
  \restartStaff
}

\gridCompileCell "guitar" 5
#+END_SRC
*** DONE Guitar Strum
CLOSED: [2016-08-19 Fri 22:40]
#+BEGIN_SRC LilyPond :tangle parts/guitar_strum-V.ily
\include "global.ily"

\gridPutMusic "guitar strum" 5
\relative c {
  \include "notes/guitar_strum-III.ily"
}

\gridCompileCell "guitar strum" 5
#+END_SRC
**** Notes
#+BEGIN_SRC LilyPond :tangle notes/guitar_strum-V.ily
g1 ~ | 2 d'4 a | bes1 ~ | 2 des4 4 |

g1 ~ | 2 d'4 a | bes2 \acciaccatura { 16 16 } 2 | d8 8 8 8 cis4-. c-. |

g,1 ~ | 2 d'4 a | bes1 ~ | 2 ges4 4 |

g1 ~ | 2 d'4 a | bes2 \acciaccatura { 16 16 } 2 | d8 8 8 8 cis4-. c-. |
#+END_SRC
*** Bass
#+BEGIN_SRC LilyPond :tangle parts/bass-V.ily
\include "global.ily"

\gridPutMusic "bass" 5
\relative c, {
  \repeat unfold 2 {
    \include "notes/bass-II.ily"
  }
}

\gridCompileCell "bass" 5
#+END_SRC
*** TODO Drums
** VI:
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 6
{
  \mark 6
  s1*16
  \bar "||"
  \break
}
#+END_SRC
*** Guitar
#+BEGIN_SRC LilyPond :tangle parts/guitar-VI.ily
\include "global.ily"

\gridPutMusic "guitar" 6
\relative c' {
  \set minimumFret = #3
  \include "notes/guitar-I.ily"
  \include "notes/guitar-IV.ily"
}

\gridCompileCell "guitar" 6
#+END_SRC
*** Bass
#+BEGIN_SRC LilyPond :tangle parts/bass-VI.ily
\include "global.ily"

\gridPutMusic "bass" 6
\relative c, {
  \repeat unfold 2 {
    \include "notes/bass-II.ily"
  }
}

\gridCompileCell "bass" 6
#+END_SRC
*** TODO Drums
** VII: Treacle
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 7
{
  \mark 7
  \tempo 4 = 69
  s1*8
  \bar "||"
  \break
}
#+END_SRC
*** DONE Guitar
CLOSED: [2016-07-10 Sun 20:29]
#+BEGIN_SRC LilyPond :tangle parts/guitar-VII.ily
\include "global.ily"

\gridPutMusic "guitar" 7
\chordmode {
  \stopStaffNotTabStaff
  \fuzzOn
  \repeat unfold 2 {
    \include "notes/guitar-VII.ily"
  }
  \fuzzOff
  \restartStaff
}

\gridCompileCell "guitar" 7
#+END_SRC
**** DONE Notes
CLOSED: [2016-07-10 Sun 20:29]
#+BEGIN_SRC LilyPond :tangle notes/guitar-VII.ily
\powerChords
\set minimumFret = #5
g,,2.:1.5.8   a,,4:1.5.8   |
\set minimumFret = #8
bes,,2.:1.5.8 c,4:1.5.8    |
\set minimumFret = #11
des,2.:1.5.8   ees,4:1.5.8 |
\set minimumFret = #15
f,1:1.5.8                  |
\set minimumFret = #3
#+END_SRC
*** DONE Guitar Strum
CLOSED: [2016-07-10 Sun 20:29]
#+BEGIN_SRC LilyPond :tangle parts/guitar_strum-VII.ily
\include "global.ily"

\gridPutMusic "guitar strum" 7
\relative c {
  \repeat unfold 2 {
    \include "notes/guitar_strum-VII.ily"
  }
}

\gridCompileCell "guitar strum" 7
#+END_SRC
**** DONE Notes
CLOSED: [2016-07-10 Sun 20:29]
#+BEGIN_SRC LilyPond :tangle notes/guitar_strum-VII.ily
g2.     a4   |
bes2.   c4   |
des2.   ees4 |
f1           |
#+END_SRC
*** DONE Bass
CLOSED: [2016-07-10 Sun 18:33]
#+BEGIN_SRC LilyPond :tangle parts/bass-VII.ily
\include "global.ily"

\gridPutMusic "bass" 7
\relative c, {
  \repeat unfold 2 {
    \include "notes/bass-VII.ily"
  }
}

\gridCompileCell "bass" 7
#+END_SRC
**** DONE Notes
CLOSED: [2016-07-10 Sun 18:33]
#+BEGIN_SRC LilyPond :tangle notes/bass-VII.ily
g2.   a4   |
bes2. c4   |
des2. ees4 |
f1         |
#+END_SRC
*** TODO Drums
** VIII: Ending
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 8
{
  \mark 8
  \Tempo
  s1*8
  \bar "|."
}
#+END_SRC
*** Guitar
#+BEGIN_SRC LilyPond :tangle parts/guitar-VIII.ily
\include "global.ily"

\gridPutMusic "guitar" 8
\relative c' {
  \include "notes/guitar-I.ily"
}

\gridCompileCell "guitar" 8
#+END_SRC
*** Bass
#+BEGIN_SRC LilyPond :tangle parts/bass-VIII.ily
\include "global.ily"

\gridPutMusic "bass" 8
\relative c, {
  \include "notes/bass-I.ily"
}

\gridCompileCell "bass" 8
#+END_SRC
*** TODO Drums
* Parts
** Guitar
   :PROPERTIES:
   :tangle:   parts/guitar.ily
   :END:
#+BEGIN_SRC LilyPond
\include "global.ily"
\include "guitar-I.ily"
\include "guitar-II.ily"
\include "guitar-III.ily"
\include "guitar-IV.ily"
\include "guitar-V.ily"
\include "guitar-VI.ily"
\include "guitar-VII.ily"
\include "guitar-VIII.ily"
#+END_SRC
** Guitar Strum
:PROPERTIES:
:tangle:   parts/guitar_strum.ily
:END:
#+BEGIN_SRC LilyPond
\include "global.ily"
\include "guitar_strum-III.ily"
\include "guitar_strum-V.ily"
\include "guitar_strum-VII.ily"
#+END_SRC
** Bass
   :PROPERTIES:
   :tangle:   parts/bass.ily
   :END:
#+BEGIN_SRC LilyPond
\include "global.ily"
\include "bass-I.ily"
\include "bass-II.ily"
\include "bass-III.ily"
\include "bass-IV.ily"
\include "bass-V.ily"
\include "bass-VI.ily"
\include "bass-VII.ily"
\include "bass-VIII.ily"
#+END_SRC
* Main
:PROPERTIES:
:tangle:   main.ly
:END:
Include the grid, templates and header metadata ([[file:include/global.ily][global.ily]]), and the parts.
#+BEGIN_SRC LilyPond
\include "global.ily"
\include "parts/guitar.ily"
\include "parts/guitar_strum.ily"
\include "parts/bass.ily"
#+END_SRC

Print out the grid while rendering and
ensure all segments are of appropriate length.
#+BEGIN_SRC LilyPond
\gridDisplay
\gridCheck
#+END_SRC

During the process of transcribing a score, it can be useful to render a
particular range of the grid. GridLy provides a function, ~gridSetRange~ to
do just that.

By default, all segments are retrieved:
#+BEGIN_SRC LilyPond :tangle no
\gridSetRange #'all
#+END_SRC

... but you can specify a dotted pair (start and end):
#+BEGIN_SRC LilyPond :tangle no
\gridSetRange #'(7 . 8)
#+END_SRC

... or a single segment index:
#+BEGIN_SRC LilyPond :tangle no
\gridSetRange 3
#+END_SRC

Configure the score to be printed, including some visual tweaks.
#+BEGIN_SRC LilyPond
\score {
  \Naptaker #guitar-open-d-tuning

  \layout {
    %% Increase the size of bar numbers by 2
    \override Score.BarNumber.font-size = #2

    %% Draw a box around bar numbers
    \override Score.BarNumber.stencil =
    #(make-stencil-boxer 0.1 0.25 ly:text-interface::print)

    \override Score.BarNumber.padding = #3
  }
}
#+END_SRC

Configure the MIDI output.
#+BEGIN_SRC LilyPond
\score {
  \unfoldRepeats \Naptaker #guitar-open-d-tuning
  \midi { }
}
#+END_SRC
