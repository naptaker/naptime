#+OPTIONS: title:t toc:t date:nil author:t email:nil num:nil
#+TITLE: Disco Ball
#+DATE: [2016-06-18 Sat]
#+AUTHOR: Eric Bailey
#+EMAIL: naptakerband@gmail.com
#+LANGUAGE: en
#+CREATOR: Emacs 25.0.94.1 (Org mode 8.3.4)

[[file:main.png]]

* Front Matter
:PROPERTIES:
:tangle:   include/global.ily
:END:
Every good LilyPond file starts with a ~\version~:
#+BEGIN_SRC LilyPond
\version "2.19.24"
#+END_SRC

Include some libraries and such:
#+BEGIN_SRC LilyPond
#(load "../../include/naptaker.scm")
\include "preamble.ily"
\include "instruments.ily"
\include "openlilylib"
\useLibrary gridly
#+END_SRC

Define some useful variables.
#+BEGIN_SRC LilyPond
Key    = { \key c \major }
Tempo  = { \tempo 4 = 192 }
global = { \Tempo \defaultTimeSignature \time 4/4 }
#+END_SRC

Then the ~\header~ metadata:
#+BEGIN_SRC LilyPond
\header {
  title     = "Disco Ball"
  opus      = "Naptime"
  composer  = "Preston Y. Drum"
  poet      = "Preston Y. Drum"
  arranger  = "Naptaker"
  copyright = "Â© 2016 Naptaker"
}
#+END_SRC

Initialize the grid and template with a list of parts
and a list of the lengths (in measures) of each segment.
#+BEGIN_SRC LilyPond
\templateInit #'("meta"
                 "vox"
                 "guitar" "guitar strum"
                 "bass"
                 "drums up" "drums down")
              #'(8 8 24 14 2)
#+END_SRC
* Segments
** I: Vocal Intro
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 1
{
  \global
  \mark 1
  s1*8
  \break
}
#+END_SRC
*** TODO Vocals
*** Guitar
#+BEGIN_SRC LilyPond :tangle parts/guitar-I.ily
\include "global.ily"

\gridPutMusic "guitar" 1 { R1*8 }

\gridCompileCell "guitar" 1
#+END_SRC
*** Bass
The bass doesn't come in until the fifth measure.
#+BEGIN_SRC LilyPond :tangle parts/bass-I.ily
\include "global.ily"

\gridPutMusic "bass" 1 { R1*8 }

\gridCompileCell "bass" 1
#+END_SRC
*** TODO Drums

** II: Full Band Intro
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 2
{
  \mark 2
  s1*8
  \break
}
#+END_SRC
*** TODO Vocals
*** Guitar
#+BEGIN_SRC LilyPond :tangle parts/guitar-II.ily
\include "global.ily"

\gridPutMusic "guitar" 2
\relative d' {
  \include "notes/guitar-II.ily"
}

\gridCompileCell "guitar" 2
#+END_SRC
**** DONE Notes
CLOSED: [2016-07-10 Sun 23:28]
#+BEGIN_SRC LilyPond :tangle notes/guitar-II.ily
\set minimumFret = #10
d4 8 8 cis4 8 8 |
c8 d8 c8 \set minimumFret = #7 b4 8 a8 b8 |
\set minimumFret = #10
d4 8 cis8 d8 fis8 d8 cis8 |
\set minimumFret = #7
b4 r8 b4 b8 a8 b8 |

\set minimumFret = #10
fis'4 fis8 fis8 f4 f8 f8 |
\set minimumFret = #9
e8 fis8 e8 dis4 r8 r4 |
\set minimumFret = #10
fis4 fis8 f8 fis8 a8 fis8 e8 |
\set minimumFret = #9
dis4 r4 r2 |
\set minimumFret = #2
#+END_SRC
*** Bass
#+BEGIN_SRC LilyPond :tangle parts/bass-II.ily
\include "global.ily"

\gridPutMusic "bass" 2
\relative c {
  \include "notes/bass-II.ily"
}

\gridCompileCell "bass" 2
#+END_SRC
*** TODO Drums
** III: Verse?
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 3
{
  \mark 3
  s1*8 \break
  s1*8 \break
  s1*8 \break
}
#+END_SRC
*** TODO Vocals
*** DONE Guitar
CLOSED: [2016-07-11 Mon 00:04]
#+BEGIN_SRC LilyPond :tangle parts/guitar-III.ily
\include "global.ily"

\gridPutMusic "guitar" 3
\chordmode {
  \stopStaffNotTabStaff
  \repeat unfold 3 {
    \include "notes/guitar-III.ily"
  }
  %% \restartStaff
}

\gridCompileCell "guitar" 3
#+END_SRC
**** DONE Notes
CLOSED: [2016-07-11 Mon 00:04]
:PROPERTIES:
:noweb:    yes
:END:
#+BEGIN_SRC LilyPond :tangle notes/guitar-III.ily
<<notes-guitar-IIIa>>
<<notes-guitar-IIIc>>

<<notes-guitar-IIIa>>
<<notes-guitar-IIId>>
#+END_SRC
#+NAME: notes-guitar-IIIa
#+BEGIN_SRC LilyPond
r4 d:5.8_. r des:5.8_. |
r8 c4:5.8_. b,8:5.8_. r2 |
#+END_SRC
#+NAME: notes-guitar-IIIb-1
#+BEGIN_SRC LilyPond
r4 d:5.8_. r8
#+END_SRC
#+NAME: notes-guitar-IIIb-2
#+BEGIN_SRC LilyPond
b,8:5.8_. | R1 |
#+END_SRC
#+NAME: notes-guitar-IIIc
#+BEGIN_SRC LilyPond
<<notes-guitar-IIIb-1>> des4:5.8_. <<notes-guitar-IIIb-2>>
#+END_SRC
#+NAME: notes-guitar-IIId
#+BEGIN_SRC LilyPond
<<notes-guitar-IIIb-1>> c4:5.8_. <<notes-guitar-IIIb-2>>
#+END_SRC
*** DONE Guitar Strum
CLOSED: [2016-07-11 Mon 00:04]
#+BEGIN_SRC LilyPond :tangle parts/guitar-strum-III.ily
\include "global.ily"

\gridPutMusic "guitar strum" 3
\relative c {
  \repeat unfold 3 {
    \include "notes/guitar-strum-III.ily"
  }
}

\gridCompileCell "guitar strum" 3
#+END_SRC
**** DONE Notes
CLOSED: [2016-07-11 Mon 00:04]
:PROPERTIES:
:noweb:    yes
:END:
#+BEGIN_SRC LilyPond :tangle notes/guitar-strum-III.ily
<<notes-guitar-strum-IIIa>>
<<notes-guitar-strum-IIIc>>

<<notes-guitar-strum-IIIa>>
<<notes-guitar-strum-IIId>>
#+END_SRC
#+NAME: notes-guitar-strum-IIIa
#+BEGIN_SRC LilyPond
r4 d_. r des_. |
r8 c4_. b,8_. r2 |
#+END_SRC
#+NAME: notes-guitar-strum-IIIb-1
#+BEGIN_SRC LilyPond
r4 d_. r8
#+END_SRC
#+NAME: notes-guitar-strum-IIIb-2
#+BEGIN_SRC LilyPond
b,8_. | R1 |
#+END_SRC
#+NAME: notes-guitar-strum-IIIc
#+BEGIN_SRC LilyPond
<<notes-guitar-strum-IIIb-1>> des4_. <<notes-guitar-strum-IIIb-2>>
#+END_SRC
#+NAME: notes-guitar-strum-IIId
#+BEGIN_SRC LilyPond
<<notes-guitar-strum-IIIb-1>> c4_. <<notes-guitar-strum-IIIb-2>>
#+END_SRC
*** Bass
#+BEGIN_SRC LilyPond :tangle parts/bass-III.ily
\include "global.ily"

\gridPutMusic "bass" 3
\relative c {
  \include "notes/bass-III.ily"
}

\gridCompileCell "bass" 3
#+END_SRC
*** TODO Drums
** IV: Chorus?
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 4
{
  \mark 4
  s1*8 \break
  s1*6 \break
  \break
}
#+END_SRC
*** TODO Vocals
*** Guitar
#+BEGIN_SRC LilyPond :tangle parts/guitar-IV.ily
\include "global.ily"

\gridPutMusic "guitar" 4
\chordmode {
  %% \stopStaffNotTabStaff
  \include "notes/guitar-IV.ily"
  \restartStaff
}

\gridCompileCell "guitar" 4
#+END_SRC
**** Notes
:PROPERTIES:
:noweb:    yes
:END:
#+BEGIN_SRC LilyPond :tangle notes/guitar-IV.ily
<<notes-guitar-IVa>>

<<notes-guitar-IVb>>

<<notes-guitar-IVc>>

<<notes-guitar-IVb>>

<<notes-guitar-IVa>>

<<notes-guitar-IVb>>

<<notes-guitar-IVc>>
#+END_SRC
#+NAME: notes-guitar-IVa
#+BEGIN_SRC LilyPond
\fuzzOn
\set minimumFret = #2
e,,1:1.5.8.10 ~ |
q1 |
#+END_SRC
#+NAME: notes-guitar-IVb
#+BEGIN_SRC LilyPond
\fuzzOff
\set minimumFret = #5
g,,4:1.5.8.10_. r r2 |
R1 |
#+END_SRC
#+NAME: notes-guitar-IVc
#+BEGIN_SRC LilyPond
\fuzzOn
\set minimumFret = #12
d8/a e4/b d8/a e4/b d8/a e8/b ~ |
e8/b d8/a e4/b d8/a e4./b |
#+END_SRC
*** TODO Guitar Strum
#+BEGIN_SRC LilyPond :tangle parts/guitar-strum-IV.ily
\include "global.ily"

\gridPutMusic "guitar strum" 4
\relative d, {
  \include "notes/guitar-strum-IV.ily"
}

\gridCompileCell "guitar strum" 4
#+END_SRC
**** TODO Notes
:PROPERTIES:
:noweb:    yes
:END:
#+BEGIN_SRC LilyPond :tangle notes/guitar-strum-IV.ily
<<notes-guitar-strum-IVab>>

<<notes-guitar-strum-IVc>>

<<notes-guitar-strum-IVab>>
#+END_SRC
#+NAME: notes-guitar-strum-IVab
#+BEGIN_SRC LilyPond
<<notes-guitar-strum-IVa>>

<<notes-guitar-strum-IVb>>
#+END_SRC
#+NAME: notes-guitar-strum-IVa
#+BEGIN_SRC LilyPond
e1        ~ | 1  |
g4-. r r2   | R1 |
#+END_SRC
#+NAME: notes-guitar-strum-IVb
#+BEGIN_SRC LilyPond
d'8 e4 d8 e4 d8 e8 ~ |
e8 d8 e4 d8 e4. |
#+END_SRC
#+NAME: notes-guitar-strum-IVc
#+BEGIN_SRC LilyPond
g,4-. r r2 | R1 |
#+END_SRC
*** Bass
#+BEGIN_SRC LilyPond :tangle parts/bass-IV.ily
\include "global.ily"

\gridPutMusic "bass" 4
\relative c {
  % \include "notes/bass-IV.ily"
  R1*16
}

\gridCompileCell "bass" 4
#+END_SRC
*** TODO Drums
** V: "Bridge"
*** Meta
#+BEGIN_SRC LilyPond :tangle include/global.ily
\gridPutMusic "meta" 5
{
  \mark 5
  s1*2
}
#+END_SRC
*** TODO Vocals
*** TODO Guitar
#+BEGIN_SRC LilyPond :tangle parts/guitar-V.ily
\include "global.ily"

\gridPutMusic "guitar" 5
\relative d, {
  \include "notes/guitar-V.ily"
}

\gridCompileCell "guitar" 5
#+END_SRC
**** Notes
#+BEGIN_SRC LilyPond :tangle notes/guitar-V.ily
\fuzzOn
\ottava #-1
\set minimumFret = #2
g4-. r g-. r |
g4 ges f e |
\ottava #0
\fuzzOff
#+END_SRC
*** TODO Guitar Strum
*** TODO Bass
*** TODO Drums
* Parts
** Guitar
   :PROPERTIES:
   :tangle:   parts/guitar.ily
   :END:
#+BEGIN_SRC LilyPond
\include "global.ily"
\include "guitar-I.ily"
\include "guitar-II.ily"
\include "guitar-III.ily"
\include "guitar-IV.ily"
\include "guitar-V.ily"
#+END_SRC
** Guitar Strum
:PROPERTIES:
:tangle:   parts/guitar-strum.ily
:END:
#+BEGIN_SRC LilyPond
\include "global.ily"
\include "guitar-strum-III.ily"
\include "guitar-strum-IV.ily"
#+END_SRC
** Bass
   :PROPERTIES:
   :tangle:   parts/bass.ily
   :END:
#+BEGIN_SRC LilyPond
\include "global.ily"
\include "bass-I.ily"
\include "bass-II.ily"
#+END_SRC
* Main
:PROPERTIES:
:tangle:   main.ly
:END:
Include the grid, templates and header metadata ([[file:include/global.ily][global.ily]]), and the parts.
#+BEGIN_SRC LilyPond
\include "global.ily"
\include "parts/bass.ily"
\include "parts/guitar.ily"
\include "parts/guitar-strum.ily"
#+END_SRC

Print out the grid while rendering and
ensure all segments are of appropriate length.
#+BEGIN_SRC LilyPond
\gridDisplay
\gridCheck
#+END_SRC

During the process of transcribing a score, it can be useful to render a
particular range of the grid. GridLy provides a function, ~gridSetRange~ to
do just that.

By default, all segments are retrieved:
#+BEGIN_SRC LilyPond :tangle no
\gridSetRange #'all
#+END_SRC

... but you can specify a dotted pair (start and end):
#+BEGIN_SRC LilyPond :tangle no
\gridSetRange #'(2 . 4)
#+END_SRC

... or a single segment index:
#+BEGIN_SRC LilyPond :tangle no
\gridSetRange 4
#+END_SRC

Configure the score to be printed, including some visual tweaks.
#+BEGIN_SRC LilyPond
\score {
  \Naptaker #guitar-open-d-tuning

  \layout {
    %% Increase the size of bar numbers by 2
    \override Score.BarNumber.font-size = #2

    %% Draw a box around bar numbers
    \override Score.BarNumber.stencil =
    #(make-stencil-boxer 0.1 0.25 ly:text-interface::print)

    \override Score.BarNumber.padding = #3
  }
}
#+END_SRC

Configure the MIDI output.
#+BEGIN_SRC LilyPond
\score {
  \unfoldRepeats \Naptaker #guitar-open-d-tuning
  \midi { }
}
#+END_SRC
